<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Terminal Portfolio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.min.css" />
    <style>
        body {
            margin: 0;
            padding: 0; /* Remove body padding */
            background-color: #1a1a1a;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Prevent page scrolling */
        }
        #terminal-container {
            flex: 1;
            background-color: #000;
            margin: 30px; /* Even margin on all sides */
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.7);
            overflow: hidden; /* Hide scrollbar */
            display: flex;
            flex-direction: column;
        }
        .terminal {
            height: 100%;
            padding: 15px; /* Add padding inside terminal */
        }
        /* Hide xterm scrollbar */
        .xterm .xterm-viewport {
            overflow-y: hidden !important;
        }
        /* Add padding to terminal content */
        .xterm-screen {
            padding: 5px;
        }
    </style>
</head>
<body>
    <div id="terminal-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.min.js"></script>
    <script>
        const term = new Terminal({
            cursorBlink: true,
            cursorStyle: 'block',
            fontSize: 14,
            fontFamily: 'Consolas, monospace',
            letterSpacing: 0,
            lineHeight: 1,
            theme: {
                background: '#000',
                foreground: '#fff',
            },
            cols: Math.floor((window.innerWidth - 120) / 9), // Account for margins
            rows: Math.floor((window.innerHeight - 120) / 20), // Account for margins
            rendererType: 'canvas',
            convertEol: true, // Enable proper line endings
            wordWrap: true, // Enable word wrap
            scrollback: 1000
        });

        // Add window resize handler
        window.addEventListener('resize', () => {
            term.resize(
                Math.floor((window.innerWidth - 120) / 9),
                Math.floor((window.innerHeight - 120) / 20)
            );
        });

        // Update terminal state with more colors and formatting
        const terminalState = {
            commandHistory: [],
            historyIndex: -1,
            currentLine: '',
            cursorPosition: 0,
            // Add colors and formatting to prompt
            prompt: '\x1b[1m\x1b[38;5;87m➜\x1b[0m \x1b[1m\x1b[38;5;76m~/portfolio\x1b[0m \x1b[38;5;39m$\x1b[0m '
        };

        // Enhanced write functions with better color formatting
        function writeLine(text = '') {
            const lines = text.split('\n');
            lines.forEach((line, index) => {
                if (index > 0) term.write('\r\n');
                // Add subtle color to default text
                term.write('\x1b[38;5;252m' + line + '\x1b[0m');
            });
            term.write('\r\n');
        }

        function writeSuccess(text) {
            term.writeln('\x1b[1m\x1b[38;5;82m' + text + '\x1b[0m');
        }

        function writeError(text) {
            term.writeln('\x1b[1m\x1b[38;5;196m' + text + '\x1b[0m');
        }

        function writeWarning(text) {
            term.writeln('\x1b[1m\x1b[38;5;214m' + text + '\x1b[0m');
        }

        function writeInfo(text) {
            term.writeln('\x1b[1m\x1b[38;5;81m' + text + '\x1b[0m');
        }

        function simulateLoading(message, duration = 1000) {
            return new Promise(resolve => {
                const frames = ['-', '\\', '|', '/'];
                let i = 0;
                term.write(message);
                
                const interval = setInterval(() => {
                    term.write('\b' + frames[i++ % frames.length]);
                }, 100);

                setTimeout(() => {
                    clearInterval(interval);
                    term.write('\b \n');
                    resolve();
                }, duration);
            });
        }

        const springEndpoints = {
            '/api/skills': {
                'languages': ['Java', 'Kotlin', 'Python'],
                'frameworks': ['Spring Boot', 'JSF'],
                'experience': '3+ years'
            },
            '/api/education': {
                'university': 'THK University',
                'degree': 'Computer Engineering',
                'gpa': 3.33,
                'achievements': ['Department First', 'Faculty Third']
            }
        };

        // Add proper text wrapping utility
        function wrapText(text, width) {
            return text.match(new RegExp(`.{1,${width}}`, 'g')) || [];
        }

        const commands = {
            help: () => {
                writeLine('\x1b[1m\x1b[38;5;81mKullanılabilir Komutlar:\x1b[0m');
                writeLine('');
                writeLine('\x1b[1m\x1b[38;5;214m  System Commands:\x1b[0m');
                writeLine('    help                    Bu yardım mesajını gösterir');
                writeLine('    clear                   Ekranı temizler');
                writeLine('    neofetch                Sistem bilgilerini gösterir');
                writeLine('');
                writeLine('  Spring Boot API Tests:');
                writeLine('    curl api/skills         Yeteneklerimi API formatında gösterir');
                writeLine('    curl api/education      Eğitim bilgilerimi API formatında gösterir');
                writeLine('');
                writeLine('  Database Interactions:');
                writeLine('    psql experience         PostgreSQL deneyimimi gösterir');
                writeLine('    mongo projects          MongoDB üzerindeki projelerimi gösterir');
                writeLine('    redis-cli stats         Redis performans metriklerimi gösterir');
                writeLine('');
                writeLine('  Docker & K8s:');
                writeLine('    docker ps               Çalışan containerlarımı gösterir');
                writeLine('    k8s status             Kubernetes cluster durumumu gösterir');
                writeLine('');
                writeLine('  Git Operations:');
                writeLine('    git log                 Commit geçmişimi gösterir');
                writeLine('    git stats              GitHub istatistiklerimi gösterir');
                writeLine('');
            },

            neofetch: async () => {
                await simulateLoading('Sistem bilgileri yükleniyor ');
                writeLine('                    -`');
                writeLine('                   .o+`                    Backend Developer');
                writeLine('                  `ooo/                    ------------------');
                writeLine('                 `+oooo:                   OS: Backend Development Pro x86_64');
                writeLine('                `+oooooo:                  Host: Sahibinden.com');
                writeLine('                -+oooooo+:                 Kernel: Java/Kotlin/Spring');
                writeLine('              `/:-:++oooo+:               Uptime: 3+ years');
                writeLine('             `/++++/+++++++:              Packages: Spring Boot, JSF, Docker');
                writeLine('            `/++++++++++++++:             Shell: Backend Tools v2.0');
                writeLine('           `/+++ooooooooooooo/`           Resolution: High Scale Systems');
                writeLine('          ./ooosssso++osssssso+`         DE: Microservices');
                writeLine('         .oossssso-````/ossssss+`        WM: Cloud Native');
                writeLine('        -osssssso.      :ssssssso.       CPU: Problem Solving @ 100%');
                writeLine('       :osssssss/        osssso+++.      GPU: Creative Thinking RTX');
                writeLine('      /ossssssss/        +ssssooo/-      Memory: 3.33/4.0 GPA');
                writeLine('    `/ossssso+/:-        -:/+osssso+-    Disk: Clean Code / patterns');
                writeLine('   `+sso+:-`                 `.-/+oso:   Battery: Always Learning');
                writeLine('  `++:.                           `-/+/');
                writeLine('  .`                                 `/');
            },

            curl: async (args) => {
                if (!args.length) {
                    writeError('Usage: curl <endpoint>');
                    writeLine('Available endpoints:');
                    writeLine('  api/skills');
                    writeLine('  api/education');
                    return;
                }

                const endpoint = '/' + args[0];
                await simulateLoading('Sending request to ' + endpoint + ' ');

                if (springEndpoints[endpoint]) {
                    writeSuccess('HTTP/1.1 200 OK');
                    writeLine('Server: nginx/1.20.1');
                    writeLine('Date: ' + new Date().toUTCString());
                    writeLine('Content-Type: application/json');
                    writeLine('Connection: keep-alive');
                    writeLine('X-Powered-By: Spring Boot');
                    writeLine('');
                    
                    // Pretty print JSON with proper width
                    const json = JSON.stringify(springEndpoints[endpoint], null, 2);
                    const width = term.cols - 2;
                    const lines = json.split('\n');
                    
                    lines.forEach(line => {
                        if (line.length > width) {
                            wrapText(line, width).forEach(wrappedLine => {
                                writeLine(wrappedLine);
                            });
                        } else {
                            writeLine(line);
                        }
                    });
                } else {
                    writeError('HTTP/1.1 404 Not Found');
                    writeLine('Server: nginx/1.20.1');
                    writeLine('Date: ' + new Date().toUTCString());
                    writeLine('Content-Type: application/json');
                    writeLine('');
                    writeLine(JSON.stringify({
                        timestamp: new Date().toISOString(),
                        status: 404,
                        error: 'Not Found',
                        path: endpoint
                    }, null, 2));
                }
            },

            psql: async () => {
                await simulateLoading('PostgreSQL\'e bağlanılıyor ');
                writeLine('psql (14.9)');
                writeLine('Type "help" for help.');
                writeLine('');
                writeLine('portfolio=# SELECT company, role, duration FROM experience ORDER BY start_date DESC;');
                writeLine(' company        | role              | duration ');
                writeLine('----------------+-------------------+----------');
                writeLine(' Sahibinden.com | Software Developer| 2y 0m    ');
                writeLine(' Hitit          | Software Developer| 0y 4m    ');
                writeLine(' Ziraat Bank    | Intern           | 0y 2m    ');
                writeLine('(3 rows)');
                writeLine('');
                writeLine('portfolio=# ');
            },

            'redis-cli': async () => {
                await simulateLoading('Redis\'e bağlanılıyor ');
                writeLine('127.0.0.1:6379> HGETALL developer:stats');
                writeLine('1) "problem_solving"');
                writeLine('2) "95"');
                writeLine('3) "backend_development"');
                writeLine('4) "92"');
                writeLine('5) "database_design"');
                writeLine('6) "88"');
                writeLine('7) "system_architecture"');
                writeLine('8) "85"');
                writeLine('127.0.0.1:6379> ');
            },

            docker: async () => {
                await simulateLoading('Container\'lar kontrol ediliyor ');
                writeLine('CONTAINER ID   IMAGE                COMMAND         CREATED          STATUS');
                writeLine('a8d3f321       portfolio-spring     "/bin/sh"      15 minutes ago   Up 15 minutes');
                writeLine('b2c4e123       portfolio-postgres   "postgres"     15 minutes ago   Up 15 minutes');
                writeLine('f5e6d789       portfolio-redis      "redis"        15 minutes ago   Up 15 minutes');
                writeLine('c1d2e345       portfolio-nginx      "nginx"        15 minutes ago   Up 15 minutes');
            },

            k8s: async () => {
                await simulateLoading('Kubernetes cluster durumu kontrol ediliyor ');
                writeLine('NAME                          READY   STATUS    RESTARTS   AGE');
                writeLine('portfolio-backend-849b8c8b4   1/1     Running   0          24h');
                writeLine('portfolio-db-5c8b9d7f6        1/1     Running   0          24h');
                writeLine('portfolio-cache-3d4e8c2a1     1/1     Running   0          24h');
                writeLine('portfolio-proxy-6f7d9e5b4     1/1     Running   0          24h');
            },

            git: async (args) => {
                if (args[0] === 'log') {
                    await simulateLoading('Git log yükleniyor ');
                    writeLine('commit a1b2c3d4e5f6g7h8i9j0 (HEAD -> main)');
                    writeLine('Author: Backend Developer <backend@dev.com>');
                    writeLine('Date:   Wed Jan 01 12:00:00 2025 +0300');
                    writeLine('');
                    writeLine('    feat: Yeni mikroservis mimarisi eklendi');
                    writeLine('');
                    writeLine('commit b2c3d4e5f6g7h8i9j0k1');
                    writeLine('Author: Backend Developer <backend@dev.com>');
                    writeLine('Date:   Tue Dec 31 15:30:00 2024 +0300');
                    writeLine('');
                    writeLine('    perf: Cache optimizasyonları yapıldı');
                } else if (args[0] === 'stats') {
                    await simulateLoading('GitHub istatistikleri yükleniyor ');
                    writeLine('═══════════════════════ GitHub Stats ═══════════════════════');
                    writeLine('█████████████░░░░░ 72% Java');
                    writeLine('████████░░░░░░░░░░ 45% Kotlin');
                    writeLine('██████░░░░░░░░░░░░ 35% Python');
                    writeLine('');
                    writeLine('Toplam Commit: 1,234');
                    writeLine('Pull Request: 156');
                    writeLine('Code Review: 234');
                    writeLine('Contribution: 89 repos');
                }
            },

            mongo: async () => {
                await simulateLoading('MongoDB\'ye bağlanılıyor ');
                writeLine('MongoDB shell version v6.0.1');
                writeLine('connecting to: mongodb://127.0.0.1:27017/portfolio');
                writeLine('');
                writeLine('> db.projects.find().pretty()');
                writeLine('{');
                writeLine('  "_id": ObjectId("5f7b1e3d2c3a4b5c6d7e8f9a"),');
                writeLine('  "name": "Sosyal Platform",');
                writeLine('  "stack": {');
                writeLine('    "backend": ["Spring Boot", "Go"],');
                writeLine('    "database": "PostgreSQL",');
                writeLine('    "cache": "Valkey",');
                writeLine('    "deployment": ["Docker", "Kubernetes"]');
                writeLine('  },');
                writeLine('  "status": "In Progress"');
                writeLine('}');
                writeLine('> ');
            },

            clear: () => {
                term.clear();
                term.write('\x1b[H'); // Move cursor to top
                terminalState.currentLine = '';
                terminalState.cursorPosition = 0;
            },
        };

        // Add command completion data
        const commandCompletions = {
            'help': [],
            'clear': [],
            'neofetch': [],
            'curl': ['api/skills', 'api/education'],
            'psql': ['experience'],
            'mongo': ['projects'],
            'redis-cli': ['stats'],
            'docker': ['ps'],
            'k8s': ['status'],
            'git': ['log', 'stats']
        };

        // Add tab completion function
        function handleTabCompletion() {
            const commandParts = terminalState.currentLine.split(' ');
            const currentCommand = commandParts[0];
            const currentArg = commandParts[1] || '';

            if (commandParts.length === 1) {
                // Complete base command
                const matches = Object.keys(commands).filter(cmd => 
                    cmd.startsWith(currentCommand.toLowerCase())
                );

                if (matches.length === 1) {
                    terminalState.currentLine = matches[0];
                    terminalState.cursorPosition = matches[0].length;
                    refreshLine();
                } else if (matches.length > 1) {
                    writeLine('');
                    writeLine(matches.join('  '));
                    term.write(terminalState.prompt + terminalState.currentLine);
                }
            } else if (commandCompletions[currentCommand]) {
                // Complete command arguments
                const matches = commandCompletions[currentCommand].filter(arg =>
                    arg.startsWith(currentArg.toLowerCase())
                );

                if (matches.length === 1) {
                    terminalState.currentLine = `${currentCommand} ${matches[0]}`;
                    terminalState.cursorPosition = terminalState.currentLine.length;
                    refreshLine();
                } else if (matches.length > 1) {
                    writeLine('');
                    writeLine(matches.join('  '));
                    term.write(terminalState.prompt + terminalState.currentLine);
                }
            }
        }

        function clearCurrentLine() {
            const currentLineLength = terminalState.prompt.length + terminalState.currentLine.length;
            term.write('\r' + ' '.repeat(currentLineLength) + '\r');
        }

        function refreshLine() {
            clearCurrentLine();
            term.write(terminalState.prompt + terminalState.currentLine);
            // Move cursor to correct position
            const moveBack = terminalState.currentLine.length - terminalState.cursorPosition;
            if (moveBack > 0) {
                term.write('\x1b[' + moveBack + 'D');
            }
        }

        function addToHistory(command) {
            if (command && command.trim() && terminalState.commandHistory[0] !== command) {
                terminalState.commandHistory.unshift(command);
                if (terminalState.commandHistory.length > 50) {
                    terminalState.commandHistory.pop();
                }
            }
        }

        term.open(document.getElementById('terminal-container'));
        writeLine(''); // Add empty line at top
        writeLine(''); // Add another empty line

        // Enhanced key event handling
        term.onKey(async ({ key, domEvent }) => {
            const ev = domEvent;
            const printable = !ev.altKey && !ev.ctrlKey && !ev.metaKey;

            if (ev.keyCode === 9) { // Tab
                ev.preventDefault();
                handleTabCompletion();
            } else if (ev.keyCode === 13) { // Enter
                term.write('\r\n');
                const command = terminalState.currentLine.trim();
                
                if (command) {
                    addToHistory(command);
                    const [cmd, ...args] = command.toLowerCase().split(' ');
                    
                    if (commands.hasOwnProperty(cmd)) {
                        try {
                            await commands[cmd](args);
                        } finally {
                            // Always write prompt after command execution
                            term.write('\r\n' + terminalState.prompt);
                        }
                    } else if (cmd === 'clear') {
                        term.clear();
                        term.write(terminalState.prompt);
                    } else {
                        writeError(`Command not found: ${cmd}`);
                        writeLine('Type "help" for available commands');
                        term.write(terminalState.prompt);
                    }
                } else {
                    // Show prompt even if command is empty
                    term.write(terminalState.prompt);
                }

                terminalState.historyIndex = -1;
                terminalState.currentLine = '';
                terminalState.cursorPosition = 0;
            }
            else if (ev.keyCode === 8) { // Backspace
                if (terminalState.cursorPosition > 0) {
                    terminalState.currentLine = 
                        terminalState.currentLine.slice(0, terminalState.cursorPosition - 1) + 
                        terminalState.currentLine.slice(terminalState.cursorPosition);
                    terminalState.cursorPosition--;
                    refreshLine();
                }
            }
            else if (ev.keyCode === 37) { // Left arrow
                if (terminalState.cursorPosition > 0) {
                    terminalState.cursorPosition--;
                    term.write('\x1b[D');
                }
            }
            else if (ev.keyCode === 39) { // Right arrow
                if (terminalState.cursorPosition < terminalState.currentLine.length) {
                    terminalState.cursorPosition++;
                    term.write('\x1b[C');
                }
            }
            else if (ev.keyCode === 38) { // Up arrow
                if (terminalState.historyIndex < terminalState.commandHistory.length - 1) {
                    terminalState.historyIndex++;
                    terminalState.currentLine = terminalState.commandHistory[terminalState.historyIndex];
                    terminalState.cursorPosition = terminalState.currentLine.length;
                    refreshLine();
                }
            }
            else if (ev.keyCode === 40) { // Down arrow
                if (terminalState.historyIndex > -1) {
                    terminalState.historyIndex--;
                    terminalState.currentLine = terminalState.historyIndex >= 0 
                        ? terminalState.commandHistory[terminalState.historyIndex]
                        : '';
                    terminalState.cursorPosition = terminalState.currentLine.length;
                    refreshLine();
                }
            }
            else if (printable && key.length === 1) {
                terminalState.currentLine = 
                    terminalState.currentLine.slice(0, terminalState.cursorPosition) +
                    key +
                    terminalState.currentLine.slice(terminalState.cursorPosition);
                terminalState.cursorPosition++;
                refreshLine();
            }
        });

        // Add resize observer for better size management
        const resizeObserver = new ResizeObserver(entries => {
            for (const entry of entries) {
                const width = entry.contentRect.width;
                const height = entry.contentRect.height;
                const cols = Math.floor((width - 20) / 9);
                const rows = Math.floor((height - 20) / 20);
                term.resize(cols, rows);
            }
        });

        resizeObserver.observe(document.getElementById('terminal-container'));

        // Initialize terminal
        writeLine('\x1b[1m\x1b[38;5;205m' + // Bright pink
            '    ____             __                __   ____            __  /__    _ __\n' +
            '   / __ )____ ______/ /_____  ____  __/ /  / __ \\___  ____/ /_/ __\\  (_) /_\n' +
            '  / __  / __/ / ___/ //_/ _ \\/ __ \\/ / /  / /_/ / _ \\/ __  / / / /  / / __/\n' +
            ' / /_/ / /_/ / /__/ ,< /  __/ / / / / /  / ____/  __/ /_/ / / / /  / / /_\n' +
            '/_____/\\__,_/\\___/_/|_|\\___/_/ /_/_/_/  /_/    \\___/\\__,_/_//_/  /_/\\__/\x1b[0m'
        );
        writeLine('');
        writeInfo('Backend Developer Terminal v2.0.0 - Type "help" for available commands');
        writeLine('');
        term.write(terminalState.prompt);

        // Remove old event listeners
        document.removeEventListener('keydown', () => {});

    </script>
</body>
</html>